# Device-to-Device協調学習による撮影者の自己位置推定と動的モデル合成手法の研究
## 概要
AI技術において学習に使うデータのプライバシー保護は重要な問題の1つとなっており、学習データではなくモデルパラメータを集約するFederated Learning(FL)が提唱された。
特に、完全分散型のFLはエッジデバイスの活用が期待されるほか、複数ベンダーが協調してシステム運用を行う今日でも特定のベンダーに依存しない持続可能性の高いシステムとして期待されている。
本研究ではインターネット上でのやり取りを行わない単純な完全分散型FLの一種であるWireless Ad Hoc Federated Learning (WAFL)によって、学習データのプライバシーを保護しサービスを安定して運用できる形で、GPSが届かない室内において撮影者のおおよその位置を撮影画像から判定するシステムである、WAFL-based Photographer Location Classification System(WAFL-PLCS)を提案した。
加えて、モデルの合成過程においてモデル間類似度に応じたモデルパラメータの合成や過去の自己モデルの合成といった動的なモデル合成が、精度に対して与える影響を考察した。
その結果、VisionTransformerの事前学習済みモデルを使用したWAFL-PLCSで、ノードの持つデータに偏りがない場合で1枚の写真から約90%、偏りがある場合で87%の精度で分類可能であり、この精度は入力する写真の枚数を増やすことによって、それぞれ約98%、約97%まで上昇するということがわかった。
また、モデル間類似度を利用したモデル合成は類似度が低い学習序盤において学習を安定させる効果が見られ、過去のモデル合成は特定のラベルに対する著しい性能の不足を改善し、データの偏りによる性能低下を低減する可能性を示した。
これらの結果は、写真からの自己位置推定が実用性を見込める精度を示し、より現実に近いタスクに対して適用する価値がある手法であることを意味するとともに、動的なモデル決定手法がデータの偏りによる性能低下や学習の不安定さを低減する一定の効果をもつ可能性を示唆している。

## システム全体図
![システム全体図](./assets/research_system2.png)
- 各デバイスは自分自身の固有のモデルと固有の学習データを持つ。
- 学習は以下ステップを繰り返すことで自分の持つデータを共有することなく進行する。
    1. 近隣にいる別のデバイスとの間でモデルパラメータの一部を加重平均する。
    2. 自分自身の学習データを使って１epochだけ学習を行う。

## モデルの合成過程について
![モデルの合成過程](./assets/aggregation_process_with_pm.png)
- 近隣のノードとモデル合成をただ繰り返している場合、同じノードとのモデル合成回数が多くなると、それまでにモデル合成で得た別のノードの情報が損なわれてしまう可能性がある。
- そこで、今モデル合成を行っている相手と合成を始める前の自分のモデル（過去の自己モデル）をとっておき、一緒に合成することでそれまでの情報の喪失を抑制する。

## プログラムについて
- definitionsディレクトリ内には、関数化して切り出したプログラムがその内容ごとにまとめられて記述されている。
- utilsの内部には、さまざまな結果描画用のプログラムが入っている。直接学習には関係しない。
- train_pos_estimation.py/train_pos_estimation_dec_data_size.pyは学習を行うメインの関数である。
    - train_pos_estimation.pyが通常通り実行する際のメイン関数。
    - train_pos_estimation_dec_data_size.pyは各デバイスの持つ写真を全て使用せず、部分的に使用することでデータの偏りを除去して実行する場合のメイン関数。今回は使用していない。
